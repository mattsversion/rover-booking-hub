<!-- views/clients.ejs -->
<% /* uses default layout 'layout' already set in server.js */ %>

<div class="container">
  <header class="page-head">
    <h1>Clients (private numbers)</h1>
    <p class="muted">
      Only private (non-Rover) numbers appear here. Mark a client as <b>Trusted</b> to enable auto-confirm (when <code>AUTO_CONFIRM_TRUSTED=1</code>).
    </p>
  </header>

  <form class="toolbar" method="get" action="/clients">
    <input class="input" name="q" value="<%= q || '' %>" placeholder="search phone or name" />
    <button class="btn">Search</button>
    <a class="link" href="/clients">Clear</a>
  </form>

  <section class="card">
    <h3>Add / update a client</h3>
    <form class="grid gap" method="post" action="/clients/save">
      <label class="field">
        <span>Phone</span>
        <input class="input" name="phone" placeholder="+15551234567" required />
      </label>
      <label class="field">
        <span>Name</span>
        <input class="input" name="name" placeholder="optional" />
      </label>
      <label class="checkbox">
        <input type="checkbox" name="isPrivate" checked /> Private (non-Rover)
      </label>
      <label class="checkbox">
        <input type="checkbox" name="trusted" /> Trusted (auto-confirm)
      </label>
      <button class="btn primary">Save</button>
    </form>
  </section>

  <section class="card">
    <div class="table-head">
      <div>Trusted</div><div>Name</div><div>Phone</div><div>Private</div><div>Updated</div><div>Actions</div>
    </div>
    <% if (!clients.length) { %>
      <div class="empty">No private clients yet.</div>
    <% } else { %>
      <% clients.forEach(c => { %>
        <div class="table-row">
          <div><%= c.trusted ? '✅' : '—' %></div>
          <div><%= c.name || '—' %></div>
          <div><code><%= c.phone %></code></div>
          <div><%= c.isPrivate ? 'yes' : 'no' %></div>
          <div><%= new Date(c.updatedAt).toLocaleString() %></div>
          <div class="row-actions">
            <form method="post" action="/clients/<%= c.id %>/toggle-trust">
              <button class="btn"><%= c.trusted ? 'Untrust' : 'Trust' %></button>
            </form>
            <form method="post" action="/clients/<%= c.id %>/delete" onsubmit="return confirm('Delete client?');">
              <button class="btn danger">Delete</button>
            </form>
          </div>
        </div>
      <% }) %>
    <% } %>
  </section>
</div>
