<h2 style="margin-top:0;">Inbox</h2>

<div class="row" style="gap:8px; align-items:center; margin-bottom:10px;">
  <div class="tabs" style="display:flex; gap:6px; flex-wrap:wrap;">
    <a class="tag <%= tab==='unread' ? 'primary' : 'ghost' %>" href="/?tab=unread">Unread (<%= counts.unread %>)</a>
    <a class="tag <%= tab==='pending' ? 'primary' : 'ghost' %>" href="/?tab=pending">Pending (<%= counts.pending %>)</a>
    <a class="tag <%= tab==='booked' ? 'primary' : 'ghost' %>" href="/?tab=booked">Booked (<%= counts.booked %>)</a>
  </div>
  <div style="margin-left:auto; display:flex; gap:8px;">
    <a class="tag" href="/exports/confirmed" target="_blank">Preview Confirmed</a>
    <a class="tag success" href="/exports/confirmed.pdf" target="_blank">üñ®Ô∏è Print Confirmed PDF</a>
    <a class="tag success" href="/bookings/new">+ New booking</a>
  </div>
</div>

<% function card(b){ const last=b.messages?.[0]; %>
  <a class="row card" href="/booking/<%= b.id %>" style="align-items:flex-start;">
    <div style="flex:1;">
      <div style="font-weight:600;"><%= b.clientName %></div>
      <div class="muted" style="font-size:12px;"><%= b.clientPhone || b.roverRelay || '‚Äî' %></div>
      <div class="muted"><b>Service:</b> <%= b.serviceType %> ‚Ä¢ <b>Dogs:</b> <%= b.dogsCount || 1 %></div>
      <div class="muted"><%= new Date(b.startAt).toLocaleString() %> ‚Üí <%= new Date(b.endAt).toLocaleString() %></div>
      <% if (last) { %>
        <div class="muted" style="margin-top:4px;">last: <%= last.direction %> ‚Ä¢ <%= new Date(last.createdAt).toLocaleString() %></div>
        <% if (last.body) { %><div style="margin-top:2px;"><%= last.body.slice(0,160) %></div><% } %>
      <% } %>
    </div>
    <% if (b.messages.some(m=>m.direction==='IN' && m.isRead===false)) { %>
      <div class="tag danger">new</div>
    <% } %>
  </a>
<% } %>

<% if (tab==='unread') { %>
  <h3>Unread</h3>
  <div class="list">
    <% if (!unread.length) { %><div class="muted">No unread conversations.</div><% } %>
    <% unread.forEach(b => { %><% card(b) %><% }) %>
  </div>
<% } %>

<% if (tab==='pending') { %>
  <h3>Pending</h3>
  <div class="list">
    <% if (!pending.length) { %><div class="muted">Nothing pending.</div><% } %>
    <% pending.forEach(b => { %><% card(b) %><% }) %>
  </div>
<% } %>

<% if (tab==='booked') { %>
  <h3>Booked</h3>
  <div class="list">
    <% if (!booked.length) { %><div class="muted">No upcoming bookings.</div><% } %>
    <% booked.forEach(b => { %><% card(b) %><% }) %>
  </div>
<% } %>
